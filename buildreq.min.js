!function(){"use strict";function e(e){var r=u.keys(n.models),o={};u.forEach(r,function(r){o[r]=i(),o[r].use(t),o[r].get("/",function(e,t){n.model([r]).find(e.queryParameters.filter).sort(e.queryParameters.sort).select(e.queryParameters.select).limit(e.queryParameters.limit).skip(e.queryParameters.skip).exec(function(o,s){n.model([r]).count(e.queryParameters.filter,function(r,o){a(t,{count:o,method:"json",query:e.queryParameters,hostname:e.get("host")+e.path,route:e.route,data:s})})})}),o[r].post("/",function(e,t){var o=new n.model([r])(e.body);o.save(function(r){return r?t.status(500).json({error:"Cannot save the data"}):void a(t,{method:"json",query:e.queryParameters,hostname:e.get("host")+e.path,route:e.route,data:o})})}),o[r].put("/:"+r+"Id",function(e,t){var s=e[o[r]];s=u.extend(s,e.body),s.save(function(r){return r?t.status(500).json({error:"Cannot update the data"}):void a(t,{method:"json",query:e.queryParameters,hostname:e.get("host")+e.path,route:e.route,data:s})})}),o[r]["delete"]("/:"+r+"Id",function(e,t){var s=e[o[r]];s.remove(function(r){return r?t.status(500).json({error:"Cannot delete the data"}):void a(t,{method:"json",query:e.queryParameters,hostname:e.get("host")+e.path,route:e.route,data:s})})}),o[r].get("/:"+r+"Id",function(e,t){a(t,{method:"json",query:e.queryParameters,hostname:e.get("host")+e.path,route:e.route,data:e[o[r]],type:r})}),o[r].param(r+"Id",function(e,t,a,s){if(!n.Types.ObjectId.isValid(s))return t.status(500).send("Parameter passed is not a valid Mongo ObjectId");try{n.model([r]).findOne({_id:s},function(t,n){return t?a(t):n?(e[o[r]]=n,void a()):a(new Error("Failed to load data "+s))})}catch(u){console.log(u),a()}}),e.use("/api/v1/"+r,o[r])})}function t(e,t,r,o){return r.headersSent?o(e):(r.status(500),void r.render("error",{error:e}))}function r(){return 0===n.connection.readyState?!1:!0}function o(e){c.query.mongoose=r(),e&&(c=u.defaultsDeep(e,c))}function a(e,t){function r(e){return e=e.trim().replace(/\s/g,"%20"),""===d?d="?"+e:d+="&"+e,d}function o(e){function o(t){return e==t?!1:!0}u.forEach(c.query,function(e,a){u.isArray(e)?u.forEach(t.query[a],function(e,t){r(t+"="+e)}):u.isObject(e)?u.forEach(t.query[a],function(e,t){r(t+"="+e)}):t.query[a]&&t.query[a]!==e&&o(a)&&r(a+"="+t.query[a])})}function a(){i.actions.reload&&(d="",o(),l.actions.reload={allowed:u.keys(t.route.methods),ref:t.hostname+d})}function s(){if(i.actions.next){d="",o("skip");var e=parseInt(t.query.limit)+parseInt(t.query.skip);e<t.count&&(r("skip="+e),l.actions.next={allowed:u.keys(t.route.methods),ref:t.hostname+d})}}function n(){if(i.actions.prev){d="",o("skip");var e=parseInt(t.query.skip)-parseInt(t.query.limit);e>0?(r("skip="+e),l.actions.prev={allowed:u.keys(t.route.methods),ref:t.hostname+d}):l.actions.prev={allowed:u.keys(t.route.methods),ref:t.hostname+d}}}var i=c.response,l={};l.actions={};{var d="";t.hostname||i.hostname}l.query=t.query||i.query,t.data&&u.isArray(t.data)&&(l.count=t.data.length||i.count,l.itemPerPage=t.data.length),l.data=t.data||i.data,l.user=t.user||i.user,l.type=t.type||i.type,l.error=t.error||{},l.success=!0,t.count?(t.data&&t.data.length<t.count?(a(),s(t.data.length)):a(),0!==t.query.skip&&n(t.query.skip)):a(),u.forEach(i["delete"],function(e){(u.isString(l[e])||u.isArray(l[e])||u.isObject(l[e])||u.isNumber(l[e]))&&delete l[e]}),e[t.method](l)}function s(e,t,o){function a(e){return-1!==g.indexOf(e)?e:p(h.sort,"sort",m.sort)}function s(e){return e<m.limit?parseInt(e):p(h.limit,"limit",m.limit)}function i(e){if(u.isArray(h.select)){var t="";return u.forEach(h.select,function(e){-1!==q.indexOf(e)?t+=e+" ":p(e,"select",m.select)}),t}return-1!==q.indexOf(e)?e:p(h.select,"select",m.select)}function l(e,t){var r="";return u.isArray(e)||(e=e.replace(","," ").split(" ")),e=u.uniq(e),u.forEach(e,function(e){-1!==v.indexOf(e)?r+=e+" ":p(e,"populateId",m.populateId)}),t&&(c.query.populateId=r),r}function d(e,t){var r="";return u.isArray(e)||(e=e.replace(","," ").split(" ")),e=u.uniq(e),u.forEach(e,function(e){-1!==q.indexOf(e)?r+=e+" ":p(e,"populateItems",m.populateItems)}),t&&(c.query.populateItems=r),r}function p(e,t,r){return y.error[t]||(y.error[t]=[]),y.error[t].push({message:m.errorMessage,value:e}),r}c.query.mongoose===!1&&(c.query.mongoose=r());var m=c.query,f={},h=e.query,y={},q=[],g=[];if(y.error={},y.filter={},m.mongoose){var v=u.keys(n.models);u.forEach(v,function(e){f[e]={},f[e].schema=[],f[e].schemaSort=[],f[e].tree=n.models[e].schema.tree,u.forEach(f[e].tree,function(t,r){q.push(r),g.push(r),g.push("-"+r),f[e].schema.push(r),f[e].schemaSort.push(r),f[e].schemaSort.push("-"+r),u.forEach(h,function(e,t){t==r&&(y.filter[t]=e)})})})}else g=q=m.schema,u.forEach(q,function(e){u.forEach(h,function(t,r){r==e&&(y.filter[r]=t)})});y.skip=h.skip||m.skip,y.where=h.where||m.where,y.equals=h.equals||m.equals,y.gt=h.gt||m.gt,y.lt=h.lt||m.lt,y["in"]=h["in"]||m["in"],y.lean=h.lean||m.lean,y.sort=h.sort?a(h.sort):m.sort,y.limit=h.limit?s(h.limit):m.limit,y.select=h.select?i(h.select):m.select,m.mongoose&&(y.populateId=h.populateId?l(h.populateId):l(v,!0),y.populateItems=h.populateItems?d(h.populateItems):d(q,!0)),u.forEach(m["delete"],function(e){(u.isString(y[e])||u.isArray(y[e])||u.isObject(y[e])||u.isNumber(y[e]))&&delete y[e]}),e.queryParameters=y,o()}var n=require("mongoose"),u=require("lodash"),i=require("express");module.exports={query:s,response:a,error:t,config:o,routing:e};var c={response:{method:"get",data:{},user:{},count:0,hostname:"",query:{},type:"",actions:{prev:!0,next:!0,reload:!0},"delete":[]},query:{sort:"-created",filter:{},limit:20,select:"",populateId:"",populateItems:"",lean:!1,skip:0,where:"",gt:1,lt:0,"in":[],equals:"",errorMessage:"Unknown Value","delete":[],mongoose:!0,schema:[]},routing:{schema:!0}};exports.isMongoId=function(e,t,r){return 1!==u.size(e.params)||n.Types.ObjectId.isValid(u.values(e.params)[0])?void r():t.status(500).send("Parameter passed is not a valid Mongo ObjectId")}}();