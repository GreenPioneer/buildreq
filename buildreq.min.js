!function(){"use strict";function e(e,t,r,s){return r.headersSent?s(e):(r.status(500),void r.render("error",{error:e}))}function t(e){e&&(a=o.defaultsDeep(e,a))}function r(e,t){function r(e){return e=e.trim().replace(/\s/g,"%20"),""===p?p="?"+e:p+="&"+e,p}function s(e){function s(t){return e==t?!1:!0}o.forEach(a.query,function(e,n){o.isArray(e)?o.forEach(t.query[n],function(e,t){r(t+"="+e)}):o.isObject(e)?o.forEach(t.query[n],function(e,t){r(t+"="+e)}):t.query[n]&&t.query[n]!==e&&s(n)&&r(n+"="+t.query[n])})}function n(){l.actions.reload&&(p="",s(),c.actions.reload={allowed:o.keys(t.route.methods),ref:t.hostname+p})}function u(){if(l.actions.next){p="",s("skip");var e=parseInt(t.query.limit)+parseInt(t.query.skip);e<t.count&&(r("skip="+e),c.actions.next={allowed:o.keys(t.route.methods),ref:t.hostname+p})}}function i(){if(l.actions.prev){p="",s("skip");var e=parseInt(t.query.skip)-parseInt(t.query.limit);e>0?(r("skip="+e),c.actions.prev={allowed:o.keys(t.route.methods),ref:t.hostname+p}):c.actions.prev={allowed:o.keys(t.route.methods),ref:t.hostname+p}}}var l=a.response,c={};c.actions={};{var p="";t.hostname||l.hostname}c.query=t.query||l.query,t.data&&o.isArray(t.data)&&(c.count=t.data.length||l.count,c.itemPerPage=t.data.length),c.data=t.data||l.data,c.user=t.user||l.user,c.type=t.user||l.type,c.error=t.error||{},c.success=!0,t.count?(t.data&&t.data.length<t.count?(n(),u(t.data.length)):n(),0!==t.query.skip&&i(t.query.skip)):n(),o.forEach(l["delete"],function(e){(o.isString(c[e])||o.isArray(c[e])||o.isObject(c[e])||o.isNumber(c[e]))&&delete c[e]}),e[t.method](c)}function s(e,t,r){function s(e){return-1!==I.indexOf(e)?e:p(m.sort,"sort",f.sort)}function u(e){return e<f.limit?parseInt(e):p(m.limit,"limit",f.limit)}function i(e){if(o.isArray(m.select)){var t="";return o.forEach(m.select,function(e){-1!==q.indexOf(e)?t+=e+" ":p(e,"select",f.select)}),t}return-1!==q.indexOf(e)?e:p(m.select,"select",f.select)}function l(e,t){var r="";return o.isArray(e)||(e=e.replace(","," ").split(" ")),e=o.uniq(e),o.forEach(e,function(e){-1!==d.indexOf(e)?r+=e+" ":p(e,"populateId",f.populateId)}),t&&(a.query.populateId=r),r}function c(e,t){var r="";return o.isArray(e)||(e=e.replace(","," ").split(" ")),e=o.uniq(e),o.forEach(e,function(e){-1!==q.indexOf(e)?r+=e+" ":p(e,"populateItems",f.populateItems)}),t&&(a.query.populateItems=r),r}function p(e,t,r){return y.error[t]||(y.error[t]=[]),y.error[t].push({message:f.errorMessage,value:e}),r}var f={};f=o.extend(f,a.query);var d=o.keys(n.models),h={},m=e.query,y={},q=[],I=[];y.error={},y.filter={},o.forEach(d,function(e){h[e]={},h[e].schema=[],h[e].schemaSort=[],h[e].tree=n.models[e].schema.tree,o.forEach(h[e].tree,function(t,r){q.push(r),I.push(r),I.push("-"+r),h[e].schema.push(r),h[e].schemaSort.push(r),h[e].schemaSort.push("-"+r),o.forEach(m,function(e,t){t==r&&(y.filter[t]=e)})})}),y.skip=m.skip||f.skip,y.where=m.where||f.where,y.equals=m.equals||f.equals,y.gt=m.gt||f.gt,y.lt=m.lt||f.lt,y["in"]=m["in"]||f["in"],y.lean=m.lean||f.lean,y.sort=m.sort?s(m.sort):f.sort,y.limit=m.limit?u(m.limit):f.limit,y.select=m.select?i(m.select):f.select,y.populateId=m.populateId?l(m.populateId):l(d,!0),y.populateItems=m.populateItems?c(m.populateItems):c(q,!0),o.forEach(f["delete"],function(e){(o.isString(y[e])||o.isArray(y[e])||o.isObject(y[e])||o.isNumber(y[e]))&&delete y[e]}),e.queryParameters=y,r()}var n=require("mongoose"),o=require("lodash");module.exports={query:s,response:r,error:e,config:t};var a={response:{method:"get",data:{},user:{},count:0,hostname:"",query:{},type:"",actions:{prev:!0,next:!0,reload:!0},"delete":[]},query:{sort:"-created",filter:{},limit:20,select:"",populateId:"",populateItems:"",lean:!1,skip:0,where:"",gt:1,lt:0,"in":[],equals:"",errorMessage:"Unknown Value","delete":[]}}}();