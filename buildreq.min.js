!function(){"use strict";function e(e,t,r,o){return r.headersSent?o(e):(r.status(500),void r.render("error",{error:e}))}function t(){return 0===n.connection.readyState?!1:!0}function r(e){u.query.mongoose=t(),e&&(u=a.defaultsDeep(e,u))}function o(e,t){function r(e){return e=e.trim().replace(/\s/g,"%20"),""===p?p="?"+e:p+="&"+e,p}function o(e){function o(t){return e==t?!1:!0}a.forEach(u.query,function(e,s){a.isArray(e)?a.forEach(t.query[s],function(e,t){r(t+"="+e)}):a.isObject(e)?a.forEach(t.query[s],function(e,t){r(t+"="+e)}):t.query[s]&&t.query[s]!==e&&o(s)&&r(s+"="+t.query[s])})}function s(){c.actions.reload&&(p="",o(),l.actions.reload={allowed:a.keys(t.route.methods),ref:t.hostname+p})}function n(){if(c.actions.next){p="",o("skip");var e=parseInt(t.query.limit)+parseInt(t.query.skip);e<t.count&&(r("skip="+e),l.actions.next={allowed:a.keys(t.route.methods),ref:t.hostname+p})}}function i(){if(c.actions.prev){p="",o("skip");var e=parseInt(t.query.skip)-parseInt(t.query.limit);e>0?(r("skip="+e),l.actions.prev={allowed:a.keys(t.route.methods),ref:t.hostname+p}):l.actions.prev={allowed:a.keys(t.route.methods),ref:t.hostname+p}}}var c=u.response,l={};l.actions={};{var p="";t.hostname||c.hostname}l.query=t.query||c.query,t.data&&a.isArray(t.data)&&(l.count=t.data.length||c.count,l.itemPerPage=t.data.length),l.data=t.data||c.data,l.user=t.user||c.user,l.type=t.user||c.type,l.error=t.error||{},l.success=!0,t.count?(t.data&&t.data.length<t.count?(s(),n(t.data.length)):s(),0!==t.query.skip&&i(t.query.skip)):s(),a.forEach(c["delete"],function(e){(a.isString(l[e])||a.isArray(l[e])||a.isObject(l[e])||a.isNumber(l[e]))&&delete l[e]}),e[t.method](l)}function s(e,r,o){function s(e){return-1!==g.indexOf(e)?e:f(h.sort,"sort",m.sort)}function i(e){return e<m.limit?parseInt(e):f(h.limit,"limit",m.limit)}function c(e){if(a.isArray(h.select)){var t="";return a.forEach(h.select,function(e){-1!==q.indexOf(e)?t+=e+" ":f(e,"select",m.select)}),t}return-1!==q.indexOf(e)?e:f(h.select,"select",m.select)}function l(e,t){var r="";return a.isArray(e)||(e=e.replace(","," ").split(" ")),e=a.uniq(e),a.forEach(e,function(e){-1!==I.indexOf(e)?r+=e+" ":f(e,"populateId",m.populateId)}),t&&(u.query.populateId=r),r}function p(e,t){var r="";return a.isArray(e)||(e=e.replace(","," ").split(" ")),e=a.uniq(e),a.forEach(e,function(e){-1!==q.indexOf(e)?r+=e+" ":f(e,"populateItems",m.populateItems)}),t&&(u.query.populateItems=r),r}function f(e,t,r){return y.error[t]||(y.error[t]=[]),y.error[t].push({message:m.errorMessage,value:e}),r}u.query.mongoose===!1&&(u.query.mongoose=t());var m=u.query,d={},h=e.query,y={},q=[],g=[];if(y.error={},y.filter={},m.mongoose){var I=a.keys(n.models);a.forEach(I,function(e){d[e]={},d[e].schema=[],d[e].schemaSort=[],d[e].tree=n.models[e].schema.tree,a.forEach(d[e].tree,function(t,r){q.push(r),g.push(r),g.push("-"+r),d[e].schema.push(r),d[e].schemaSort.push(r),d[e].schemaSort.push("-"+r),a.forEach(h,function(e,t){t==r&&(y.filter[t]=e)})})})}else g=q=m.schema,a.forEach(q,function(e){a.forEach(h,function(t,r){r==e&&(y.filter[r]=t)})});y.skip=h.skip||m.skip,y.where=h.where||m.where,y.equals=h.equals||m.equals,y.gt=h.gt||m.gt,y.lt=h.lt||m.lt,y["in"]=h["in"]||m["in"],y.lean=h.lean||m.lean,y.sort=h.sort?s(h.sort):m.sort,y.limit=h.limit?i(h.limit):m.limit,y.select=h.select?c(h.select):m.select,m.mongoose&&(y.populateId=h.populateId?l(h.populateId):l(I,!0),y.populateItems=h.populateItems?p(h.populateItems):p(q,!0)),a.forEach(m["delete"],function(e){(a.isString(y[e])||a.isArray(y[e])||a.isObject(y[e])||a.isNumber(y[e]))&&delete y[e]}),e.queryParameters=y,o()}var n=require("mongoose"),a=require("lodash");module.exports={query:s,response:o,error:e,config:r};var u={response:{method:"get",data:{},user:{},count:0,hostname:"",query:{},type:"",actions:{prev:!0,next:!0,reload:!0},"delete":[]},query:{sort:"-created",filter:{},limit:20,select:"",populateId:"",populateItems:"",lean:!1,skip:0,where:"",gt:1,lt:0,"in":[],equals:"",errorMessage:"Unknown Value","delete":[],mongoose:!0,schema:[]}}}();